machine:
  node:
    version: 8.9.4

general:
  branches:
    ignore:
      - gh-pages

dependencies:
  cache_directories:
    - ~/.cache/yarn
    - node_modules
  override:
    - yarn --prefer-offline --frozen-lockfile

test:
<% if (false) { -%>
  pre:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
<% } -%>
  override:
    - yarn run preversion
    - yarn run test
<% if (documentation) { -%>
    - yarn run generate:docs
<% if (testing) { -%>
    - yarn run generate:test-coverage
<% } -%>
<% } -%>
<% if (documentation || (testing && codecov)) { -%>
  post:
<% if (codecov) { -%>
    - bash <(curl -s https://codecov.io/bash)
<% } -%>
    - cp -R docs $CIRCLE_ARTIFACTS/
<% } -%>

<% if (documentation) { -%>
deployment:
  docs:
    branch: master
    commands:
      - git config user.email "builds@circleci.com"
      - git config user.name "CircleCi"
      - git add -f docs coverage
      - 'git commit -m "docs: update generated docs [skip ci]"'
      - git push
<% } -%>
