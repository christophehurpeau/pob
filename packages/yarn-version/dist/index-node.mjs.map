{"version":3,"file":"index-node.mjs","sources":["../src/utils/UsageError.ts","../src/utils/mapUtils.ts","../src/utils/packageDependenciesUtils.ts","../src/utils/workspaceUtils.ts","../src/utils/bumpTypeUtils.ts","../src/utils/conventionalChangelogUtils.ts","../src/utils/conventionalCommitConfigUtils.ts","../src/utils/execCommand.ts","../src/utils/generatorUtils.ts","../src/utils/gitUtils.ts","../src/utils/githubUtils.ts","../src/utils/packageUtils.ts","../src/utils/updateChangelog.ts","../src/commands/version.ts","../src/index.ts"],"sourcesContent":["export class UsageError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"UsageError\";\n  }\n}\n","export function getMapArrayItemForKey<K, V>(map: Map<K, V[]>, key: K): V[] {\n  let value: V[] | undefined = map.get(key);\n  if (value === undefined) {\n    map.set(key, (value = [] as V[]));\n  }\n  return value;\n}\n","/**\n * Combination of an optional scope and name.\n *\n * eg `@npm/types`\n */\nexport interface PackageDescriptorName {\n  scope?: string;\n  name: string;\n}\n\ninterface DescriptorUtils<Descriptor> {\n  parse: (value: string) => Descriptor;\n  stringify: (descriptor: Descriptor) => string;\n}\n\nexport const PackageDescriptorNameUtils: DescriptorUtils<PackageDescriptorName> =\n  {\n    parse: (value) => {\n      if (value.startsWith(\"@\")) {\n        const [scope, name] = value.slice(1).split(\"/\", 2);\n        if (!scope || !name) {\n          throw new Error(`Invalid package descriptor name: ${value}`);\n        }\n        return { scope, name };\n      }\n      return { name: value };\n    },\n    stringify: (descriptor) => {\n      return descriptor.scope === undefined\n        ? descriptor.name\n        : `@${descriptor.scope}/${descriptor.name}`;\n    },\n  };\n\nexport interface PackageDependencyDescriptor {\n  key: string;\n  name: PackageDescriptorName;\n  selector: string; // can be npm tag or version or version range or git url or local folder path\n}\n\ninterface PackageDependencyDescriptorUtils<\n  Descriptor = PackageDependencyDescriptor,\n> {\n  make: (descriptor: Descriptor, selector: string) => Descriptor;\n  parse: (dependencyKey: string, dependencyValue: string) => Descriptor;\n  stringify: (descriptor: Descriptor) => [key: string, value: string];\n}\n\nexport const PackageDependencyDescriptorUtils: PackageDependencyDescriptorUtils =\n  {\n    make: (descriptor, selector) => {\n      return { key: descriptor.key, name: descriptor.name, selector };\n    },\n    parse: (dependencyKey, dependencyValue) => {\n      const [name, selector] = dependencyValue.startsWith(\"npm:\")\n        ? (() => {\n            const v = dependencyValue.slice(\"npm:\".length);\n            if (!v.startsWith(\"@\")) return v.split(\"@\", 2) as [string, string];\n            const [packageNameWithoutFirstChar, selector] = v\n              .slice(1)\n              .split(\"@\", 2);\n            if (!packageNameWithoutFirstChar || !selector) {\n              throw new Error(`Invalid package descriptor: ${dependencyValue}`);\n            }\n            return [`@${packageNameWithoutFirstChar}`, selector];\n          })()\n        : [dependencyKey, dependencyValue];\n\n      return {\n        key: dependencyKey,\n        name: PackageDescriptorNameUtils.parse(name),\n        selector,\n      };\n    },\n    stringify: (descriptor) => {\n      return [descriptor.key, descriptor.selector];\n    },\n  };\n\n// export const PackageDependencySelectorUtils;\n","/* eslint-disable complexity */\nimport path from \"node:path\";\nimport { getMapArrayItemForKey } from \"./mapUtils.ts\";\nimport type { PackageDependencyDescriptor } from \"./packageDependenciesUtils.ts\";\nimport {\n  PackageDependencyDescriptorUtils,\n  PackageDescriptorNameUtils,\n} from \"./packageDependenciesUtils.ts\";\nimport type { ProjectWorkspace, Workspace } from \"./packageUtils.ts\";\n\nconst allDependenciesTypes = [\n  \"dependencies\",\n  \"devDependencies\",\n  \"peerDependencies\",\n] as const;\nexport type DependencyType = (typeof allDependenciesTypes)[number];\n\nexport const getWorkspaceName = (workspace: Workspace): string => {\n  return (\n    workspace.pkg.name ?? (path.basename(workspace.cwd) || \"unnamed-workspace\")\n  );\n};\n\ntype WorkspacesDependenciesMap = Map<\n  Workspace,\n  [Workspace, DependencyType, PackageDependencyDescriptor][]\n>;\n\nexport const buildDependentsMaps = (\n  project: ProjectWorkspace,\n): WorkspacesDependenciesMap => {\n  const dependentsMap: WorkspacesDependenciesMap = new Map<\n    Workspace,\n    [Workspace, DependencyType, PackageDependencyDescriptor][]\n  >();\n\n  // Note that we need to do this before applying the new versions,\n  // otherwise the `findWorkspacesByDescriptor` calls won't be able to\n  // resolve the workspaces anymore (because the workspace versions will\n  // have changed and won't match the outdated dependencies).\n\n  for (const [, dependent] of project.children) {\n    for (const set of allDependenciesTypes) {\n      for (const [dependencyKey, dependencyValue] of Object.entries(\n        dependent.pkg[set] || {},\n      )) {\n        if (!dependencyValue) continue;\n        const descriptor = PackageDependencyDescriptorUtils.parse(\n          dependencyKey,\n          dependencyValue,\n        );\n        const workspace = project.children.get(\n          PackageDescriptorNameUtils.stringify(descriptor.name),\n        );\n        if (!workspace) continue;\n\n        const dependents = getMapArrayItemForKey(dependentsMap, workspace);\n        dependents.push([dependent, set, descriptor]);\n      }\n    }\n  }\n\n  return dependentsMap;\n};\n\nexport const buildDependenciesMaps = (\n  project: ProjectWorkspace,\n): WorkspacesDependenciesMap => {\n  const dependenciesMap: WorkspacesDependenciesMap = new Map<\n    Workspace,\n    [Workspace, DependencyType, PackageDependencyDescriptor][]\n  >();\n\n  // Note that we need to do this before applying the new versions,\n  // otherwise the `findWorkspacesByDescriptor` calls won't be able to\n  // resolve the workspaces anymore (because the workspace versions will\n  // have changed and won't match the outdated dependencies).\n\n  for (const dependent of project.children.values()) {\n    for (const set of allDependenciesTypes) {\n      for (const [dependencyKey, dependencyValue] of Object.entries(\n        dependent.pkg[set] || {},\n      )) {\n        if (!dependencyValue) continue;\n        const descriptor = PackageDependencyDescriptorUtils.parse(\n          dependencyKey,\n          dependencyValue,\n        );\n\n        const workspace = project.children.get(\n          PackageDescriptorNameUtils.stringify(descriptor.name),\n        );\n        if (!workspace) continue;\n\n        const dependencies = getMapArrayItemForKey(dependenciesMap, dependent);\n        dependencies.push([workspace, set, descriptor]);\n      }\n    }\n  }\n\n  return dependenciesMap;\n};\n\nexport const buildTopologicalOrderBatches = (\n  project: ProjectWorkspace,\n  dependenciesMap: WorkspacesDependenciesMap,\n): Workspace[][] => {\n  const batches: Workspace[][] = [];\n\n  const added = new Set<Workspace>();\n  const toAdd = new Set<Workspace>([\n    project.root,\n    ...project.children.values(),\n  ]);\n\n  while (toAdd.size > 0) {\n    const batch = new Set<Workspace>();\n    for (const workspace of toAdd) {\n      // make sure top level workspace is always in the last batch\n      if (workspace === project.root && toAdd.size > 1) {\n        continue;\n      }\n\n      const dependencies = dependenciesMap.get(workspace);\n      if (!dependencies || dependencies.every((w) => added.has(w[0]))) {\n        batch.add(workspace);\n      }\n    }\n\n    for (const workspace of batch) {\n      added.add(workspace);\n      toAdd.delete(workspace);\n    }\n\n    if (batch.size === 0) {\n      throw new Error(\"Circular dependency detected\");\n    }\n    batches.push([...batch]);\n  }\n\n  return batches;\n};\n","import semver from \"semver\";\nimport { UsageError } from \"./UsageError.ts\";\nimport type { Workspace } from \"./packageUtils.ts\";\nimport { getWorkspaceName } from \"./workspaceUtils.ts\";\n\nexport type BumpType = \"major\" | \"minor\" | \"patch\";\n\n// https://github.com/yarnpkg/berry/blob/506ded5f5f5a89553435940c74f1d857fd685a42/packages/plugin-version/sources/versionUtils.ts#L10\n// Basically we only support auto-upgrading the ranges that are very simple (^x.y.z, ~x.y.z, >=x.y.z, and of course x.y.z)\nconst SUPPORTED_UPGRADE_REGEXP =\n  // eslint-disable-next-line regexp/no-unused-capturing-group\n  /^((?:>=|[~^])?)(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(-(0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*)(\\.(0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*))*)?(\\+[0-9a-z-]+(\\.[0-9a-z-]+)*)?$/i;\n\nconst yarnWorkspaceProtocol = \"workspace:\";\n\nexport const calcBumpRange = (\n  workspace: Workspace,\n  range: string,\n  newVersion: string,\n): string => {\n  if (range === \"*\") {\n    return range;\n  }\n\n  let useWorkspaceProtocol = false;\n\n  if (range.startsWith(yarnWorkspaceProtocol)) {\n    const slicedRange = range.slice(yarnWorkspaceProtocol.length);\n\n    // Workspaces referenced through their path never get upgraded (\"workspace:packages/yarnpkg-core\")\n    if (slicedRange === workspace.relativeCwd) {\n      return range;\n    }\n\n    if (slicedRange === \"*\") {\n      return range;\n    }\n\n    range = slicedRange;\n    useWorkspaceProtocol = true;\n  }\n\n  const parsed = SUPPORTED_UPGRADE_REGEXP.exec(range);\n  if (!parsed) {\n    const workspaceName = getWorkspaceName(workspace);\n    throw new Error(`Couldn't bump range ${range} in ${workspaceName}`);\n  }\n\n  return `${useWorkspaceProtocol ? yarnWorkspaceProtocol : \"\"}${\n    parsed[1] ?? \"\"\n  }${newVersion}`;\n};\n\nexport const getHighestBumpType = (bumpTypes: BumpType[]): BumpType => {\n  if (bumpTypes.includes(\"major\")) {\n    return \"major\";\n  }\n\n  if (bumpTypes.includes(\"minor\")) {\n    return \"minor\";\n  }\n\n  return \"patch\";\n};\n\nexport const calcBumpType = (\n  bumpType: BumpType,\n  maxBumpType: BumpType,\n): BumpType => {\n  if (maxBumpType === \"major\") {\n    return bumpType;\n  }\n\n  if (maxBumpType === \"minor\") {\n    return bumpType === \"major\" || bumpType === \"minor\" ? \"minor\" : \"patch\";\n  }\n\n  return \"patch\";\n};\n\nconst incVersion = (version: string, bumpType: BumpType): string | null => {\n  // handle breaking of 0.x\n  if (bumpType === \"major\" && semver.major(version) === 0) {\n    bumpType = \"minor\";\n  }\n  return semver.inc(version, bumpType);\n};\n\nexport const incrementVersion = (\n  workspace: Workspace,\n  currentVersion: string,\n  bumpType: BumpType,\n): string => {\n  const newVersion = incVersion(currentVersion, bumpType);\n\n  if (!newVersion) {\n    throw new UsageError(\n      `Could not determine next version for \"${getWorkspaceName(\n        workspace,\n      )}\" (currentVersion: ${currentVersion}, bumpType: ${bumpType}})`,\n    );\n  }\n\n  return newVersion;\n};\n\n// const createPrerelease = (\n//   version: string,\n//   prereleaseType: ReleaseType,\n//   prereleaseId: string,\n// ) => {\n//   return semver.inc(version, prereleaseType, prereleaseId);\n// };\n","import type { Readable } from \"node:stream\";\nimport { text } from \"node:stream/consumers\";\nimport conventionalChangelogCore from \"conventional-changelog-core\";\nimport type { Commit } from \"conventional-commits-parser\";\nimport type { BumperRecommendation } from \"conventional-recommended-bump\";\nimport type { PackageJson } from \"type-fest\";\nimport type { ConventionalChangelogConfig } from \"./conventionalCommitConfigUtils.ts\";\nimport type { Workspace } from \"./packageUtils.ts\";\n\nconst versions: BumperRecommendation[\"releaseType\"][] = [\n  \"major\",\n  \"minor\",\n  \"patch\",\n];\nexport const recommendBump = async (\n  commits: Commit[],\n  config: ConventionalChangelogConfig,\n): Promise<BumperRecommendation> => {\n  const whatBump = config.whatBump;\n  if (!whatBump) {\n    throw new Error(\"whatBump method is missing in config\");\n  }\n  let result: BumperRecommendation = { ...(await whatBump(commits)) };\n  if (result.level != null) {\n    result.releaseType = versions[result.level];\n  } else if (result == null) {\n    result = {};\n  }\n\n  return result;\n};\n\nexport const generateChangelog = (\n  workspace: Workspace,\n  pkg: PackageJson,\n  config: ConventionalChangelogConfig,\n  newTag: string | null,\n  {\n    previousTag = \"\",\n    verbose = false,\n    tagPrefix = \"v\",\n    path = \"\",\n    lernaPackage,\n  }: {\n    previousTag?: string;\n    verbose?: boolean;\n    tagPrefix?: string;\n    path?: string;\n    lernaPackage?: string;\n  } = {},\n  // eslint-disable-next-line @typescript-eslint/max-params\n): Promise<string> => {\n  if (!newTag) {\n    throw new Error(`Missing new tag for package \"${pkg.name ?? \"\"}\"`);\n  }\n  const stream: Readable = conventionalChangelogCore(\n    {\n      cwd: workspace.cwd,\n      config,\n      pkg,\n      path,\n      append: !!previousTag,\n      releaseCount: !previousTag ? 0 : 1,\n      skipUnstable: true,\n      lernaPackage,\n      tagPrefix,\n      verbose,\n      previousTag,\n      currentTag: newTag,\n    },\n    {\n      version: pkg.version,\n      currentTag: newTag,\n      previousTag,\n    },\n    // @ts-expect-error -- path is required to filter commits by path. It does not work if it is only provided in options.\n    {\n      from: previousTag,\n      path,\n    },\n  );\n\n  return text(stream);\n};\n","// eslint-disable-next-line import/no-unresolved\nimport { loadPreset } from \"conventional-changelog-preset-loader\";\nimport type { Preset } from \"conventional-recommended-bump\";\nimport { UsageError } from \"./UsageError.ts\";\nimport type { Workspace } from \"./packageUtils.ts\";\n\nexport type ConventionalChangelogConfig = Preset;\n\nexport const loadConventionalCommitConfig = async (\n  rootWorkspace: Workspace,\n  preset: string,\n): Promise<ConventionalChangelogConfig> => {\n  try {\n    return await loadPreset<ConventionalChangelogConfig>(preset);\n  } catch (error: any) {\n    throw new UsageError(\n      `Failed to require preset \"${preset}\": ${error.message as string}`,\n    );\n  }\n};\n","import childProcess from \"node:child_process\";\nimport type { Workspace } from \"./packageUtils.ts\";\n\ninterface ExecResultIfFailed {\n  code: number | null;\n  signal: string | null;\n  stdout: string;\n  stderr: string;\n}\n\ninterface ExecResultIfSuccess {\n  code: null;\n  signal: null;\n  stdout: string;\n  stderr: string;\n}\n\ntype ExecResult<Strict extends boolean> = Strict extends true\n  ? ExecResultIfSuccess\n  : ExecResultIfFailed;\n\nasync function execvp<const Strict extends boolean>(\n  command: string,\n  args: string[],\n  {\n    cwd = process.cwd(),\n    env = process.env,\n    encoding,\n    strict,\n    stdo = \"pipe\",\n  }: {\n    cwd?: string;\n    env?: typeof process.env;\n    encoding?: BufferEncoding;\n    strict?: Strict;\n    stdo?: \"inherit\" | \"pipe\";\n  },\n): Promise<ExecResult<Strict>> {\n  const stdoutChunks: Uint8Array[] = [];\n  const stderrChunks: Uint8Array[] = [];\n  if (env.PWD !== undefined) {\n    env = { ...env, PWD: cwd };\n  }\n  const subprocess = childProcess.spawn(command, args, {\n    cwd,\n    env,\n    stdio: [\"ignore\", stdo, stdo],\n  });\n  subprocess.stdout?.on(\"data\", (chunk) => {\n    stdoutChunks.push(chunk);\n  });\n  subprocess.stderr?.on(\"data\", (chunk) => {\n    stderrChunks.push(chunk);\n  });\n  return new Promise((resolve, reject) => {\n    subprocess.on(\"error\", (err) => {\n      reject(new Error(`Process ${command} failed to spawn`));\n    });\n    subprocess.on(\"close\", (code, signal) => {\n      const chunksToString = (chunks: Uint8Array[]): string =>\n        stdo === \"inherit\"\n          ? \"\"\n          : Buffer.concat(chunks).toString(encoding ?? \"utf8\");\n      const stdout = chunksToString(stdoutChunks);\n      const stderr = chunksToString(stderrChunks);\n      if (code === 0 || !strict) {\n        resolve({\n          code,\n          signal,\n          stdout,\n          stderr,\n        } as ExecResult<Strict>);\n      } else {\n        reject(\n          new Error(\n            `Process ${[command, ...args].join(\" \")} exited ${code !== null ? `with code ${code}` : `with signal ${signal || \"\"}`}:\\nstdout: ${stdout.toString()}\\nstderr: ${stderr.toString()}`,\n          ),\n        );\n      }\n    });\n  });\n}\n\nasync function* spawnStreamStdout<const Strict extends boolean>(\n  command: string,\n  args: string[],\n  {\n    cwd = process.cwd(),\n    env = process.env,\n    encoding,\n    strict,\n    separator,\n  }: {\n    cwd?: string;\n    env?: typeof process.env;\n    encoding?: BufferEncoding;\n    strict?: Strict;\n    separator: string;\n  },\n): AsyncGenerator<string, ExecResult<Strict>, unknown> {\n  const stderrChunks: Uint8Array[] = [];\n  if (env.PWD !== undefined) {\n    env = { ...env, PWD: cwd };\n  }\n  const subprocess = childProcess.spawn(command, args, {\n    cwd,\n    env,\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n  });\n\n  subprocess.stderr.on(\"data\", (chunk) => {\n    stderrChunks.push(chunk);\n  });\n\n  let chunk: Buffer;\n  let payload: string[];\n  let buffer = \"\";\n\n  for await (chunk of subprocess.stdout) {\n    buffer += chunk.toString();\n\n    if (buffer.includes(separator)) {\n      payload = buffer.split(separator);\n      buffer = payload.pop() || \"\";\n\n      yield* payload;\n    }\n  }\n\n  if (buffer) {\n    yield buffer;\n  }\n\n  return new Promise((resolve, reject) => {\n    subprocess.on(\"error\", (err) => {\n      reject(new Error(`Process ${command} failed to spawn`));\n    });\n    subprocess.on(\"close\", (code, signal) => {\n      const chunksToString = (chunks: Uint8Array[]): string =>\n        Buffer.concat(chunks).toString(encoding ?? \"utf8\");\n      const stderr = chunksToString(stderrChunks);\n      if (code === 0 || !strict) {\n        resolve({\n          code,\n          signal,\n          stderr,\n        } as ExecResult<Strict>);\n      } else {\n        reject(\n          new Error(\n            `Process ${[command, ...args].join(\" \")} exited ${code !== null ? `with code ${code}` : `with signal ${signal || \"\"}`}:\\nstderr: ${stderr.toString()}`,\n          ),\n        );\n      }\n    });\n  });\n}\n\nexport const execCommand = (\n  workspace: Workspace,\n  commandAndArgs: string[] = [],\n  stdo: \"inherit\" | \"pipe\" = \"pipe\",\n): ReturnType<typeof execvp> => {\n  const [command, ...args] = commandAndArgs;\n  if (command === undefined) {\n    throw new Error(\"Command is required\");\n  }\n  return execvp(command, args, {\n    cwd: workspace.cwd,\n    strict: true,\n    stdo,\n  });\n};\n\nexport const execCommandStreamStdout = (\n  workspace: Workspace,\n  commandAndArgs: string[] = [],\n  separator = \"\\n\",\n): AsyncGenerator<string, ExecResult<true>, unknown> => {\n  const [command, ...args] = commandAndArgs;\n  if (command === undefined) {\n    throw new Error(\"Command is required\");\n  }\n  return spawnStreamStdout(command, args, {\n    cwd: workspace.cwd,\n    strict: true,\n    separator,\n  });\n};\n","export async function asyncIterableToArray<T>(\n  asyncIterable: AsyncIterable<T>,\n): Promise<T[]> {\n  const result: T[] = [];\n\n  for await (const value of asyncIterable) {\n    result.push(value);\n  }\n\n  return result;\n}\n","import semver from \"semver\";\nimport { UsageError } from \"./UsageError.ts\";\nimport { execCommand, execCommandStreamStdout } from \"./execCommand.ts\";\nimport type { Workspace } from \"./packageUtils.ts\";\n\nexport const getGitCurrentBranch = async (\n  workspace: Workspace,\n): Promise<string> => {\n  const { stdout } = await execCommand(workspace, [\n    \"git\",\n    \"rev-parse\",\n    \"--abbrev-ref\",\n    \"HEAD\",\n  ]);\n  const currentBranch = stdout.trim();\n\n  if (currentBranch === \"HEAD\") {\n    throw new UsageError(\"HEAD is detached. Please checkout a branch.\");\n  }\n\n  return currentBranch;\n};\n\nexport const createGitCommit = async (\n  workspace: Workspace,\n  commitMessage: string,\n): Promise<void> => {\n  await execCommand(workspace, [\"git\", \"add\", \"-A\"]);\n\n  await execCommand(workspace, [\n    \"git\",\n    \"commit\",\n    \"--no-verify\",\n    \"-m\",\n    commitMessage,\n  ]);\n};\n\nexport const createGitTag = async (\n  workspace: Workspace,\n  newTag: string,\n): Promise<void> => {\n  await execCommand(workspace, [\"git\", \"tag\", newTag, \"-m\", newTag]);\n};\n\nexport const pushCommitsAndTags = async (\n  workspace: Workspace,\n  gitRemote: string,\n  currentBranch: string,\n): Promise<void> => {\n  await execCommand(workspace, [\n    \"git\",\n    \"push\",\n    \"--follow-tags\",\n    \"--no-verify\",\n    \"--atomic\",\n    gitRemote,\n    currentBranch,\n  ]);\n};\n\nexport const isBehindRemote = async (\n  workspace: Workspace,\n  gitRemote: string,\n  currentBranch: string,\n): Promise<boolean> => {\n  await execCommand(workspace, [\"git\", \"remote\", \"update\", gitRemote]);\n  const { stdout } = await execCommand(workspace, [\n    \"git\",\n    \"rev-list\",\n    \"--left-right\",\n    \"--count\",\n    `${gitRemote}/${currentBranch}..${currentBranch}`,\n  ]);\n\n  const [behind] = stdout.split(\"\\t\").map((val) => parseInt(val, 10));\n\n  return behind ? behind > 0 : false;\n};\n\nexport const getDirtyFiles = async (workspace: Workspace): Promise<string> => {\n  const { stdout: dirtyFiles } = await execCommand(workspace, [\n    \"git\",\n    \"status\",\n    \"--porcelain\",\n  ]);\n  return dirtyFiles;\n};\n\n// TODO fix this method as it is not safe : it sorts by creator date and does not look for real commits order.\n// Also we could avoid this method and just look for previous commits (for the changelog) until we find a valid tag.\n// eslint-disable-next-line complexity\nexport const getGitLatestTagVersion = async (\n  workspace: Workspace,\n  currentBranch: string,\n  {\n    prefix,\n    skipUnstable,\n  }: {\n    prefix?: string;\n    skipUnstable?: boolean;\n  } = {},\n): Promise<{ tag: string; version: string } | null> => {\n  for await (const tag of execCommandStreamStdout(workspace, [\n    \"git\",\n    \"tag\",\n    \"--merged\",\n    currentBranch,\n    // - means reverse order\n    \"--sort=-creatordate\",\n    ...(prefix ? [\"--list\", `${prefix}*`] : []),\n  ])) {\n    if (tag) {\n      const version = prefix ? tag.slice(prefix.length) : tag;\n      if (!semver.valid(version)) {\n        continue;\n      }\n      if (skipUnstable && semver.prerelease(version)) {\n        continue;\n      }\n      return { tag, version };\n    }\n  }\n\n  return null;\n};\n","// eslint-disable-next-line import/no-unresolved -- esm-only package which is not supported by import plugin.\nimport { Octokit } from \"@octokit/rest\";\nimport { UsageError } from \"./UsageError.ts\";\nimport type { Workspace } from \"./packageUtils.ts\";\n\nexport async function createGitHubClient(): Promise<Octokit> {\n  const { GH_TOKEN, GHE_API_URL, GHE_VERSION } = process.env;\n\n  if (!GH_TOKEN) {\n    throw new UsageError(\n      '\"GH_TOKEN\" environment variable required when \"createRelease\" is set to \"github\"',\n    );\n  }\n\n  if (GHE_VERSION) {\n    Octokit.plugin(\n      await import(`@octokit/plugin-enterprise-rest/ghe-${GHE_VERSION}`),\n    );\n  }\n\n  const options = {\n    auth: `token ${GH_TOKEN}`,\n  };\n\n  if (GHE_API_URL) {\n    // TODO: refactor based on TS feedback\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    options.baseUrl = GHE_API_URL;\n  }\n\n  return new Octokit(options);\n}\n\ninterface ParsedGithubUrl {\n  username: string;\n  reponame: string;\n}\n\nconst githubRegex = /^https?:\\/\\/github.com\\/([^#/]+)\\/([^#/]+?)(?:\\.git)?$/;\nexport const parseGithubRepoUrl = (workspace: Workspace): ParsedGithubUrl => {\n  const repository = workspace.pkg.repository;\n\n  const url: string | undefined =\n    typeof repository === \"string\" ? repository : repository?.url;\n\n  if (!url) {\n    throw new Error(\n      \"No repository URL found in manifest. Please add one and try again. https://docs.npmjs.com/cli/v9/configuring-npm/package-json#repository\",\n    );\n  }\n  const match = githubRegex.exec(url);\n\n  if (!match) {\n    throw new Error(`Invalid GitHub repository URL: \"${url}\"`);\n  }\n  const [, username, reponame] = match;\n  if (!username || !reponame) {\n    throw new Error(`Invalid GitHub repository URL: ${url}`);\n  }\n  return { username, reponame };\n};\n\nexport const createGitRelease = async (\n  githubClient: Octokit,\n  parsedRepoUrl: ParsedGithubUrl,\n  tag: string,\n  body: string,\n  prerelease: boolean,\n  // eslint-disable-next-line @typescript-eslint/max-params\n): Promise<void> => {\n  await githubClient.repos.createRelease({\n    owner: parsedRepoUrl.username,\n    repo: parsedRepoUrl.reponame,\n    // eslint-disable-next-line camelcase\n    tag_name: tag,\n    name: tag,\n    body,\n    draft: false,\n    prerelease,\n  });\n};\n","/* eslint-disable @typescript-eslint/no-use-before-define */\nimport fs from \"node:fs/promises\";\nimport path from \"node:path\";\nimport mapWorkspaces from \"@npmcli/map-workspaces\";\nimport prettyPkg from \"@pob/pretty-pkg\";\nimport type { PackageJson } from \"type-fest\";\n\nexport interface Workspace {\n  readonly cwd: string;\n  readonly relativeCwd?: string;\n  readonly pkg: PackageJson;\n}\n\nexport interface ProjectWorkspace {\n  readonly root: Workspace;\n  readonly children: Map<string, Workspace>;\n}\n\nexport const createProjectWorkspace = async (\n  root: Workspace,\n): Promise<ProjectWorkspace> => {\n  const map: Map<string, string> = root.pkg.workspaces\n    ? await mapWorkspaces({ cwd: root.cwd, pkg: root.pkg })\n    : new Map();\n\n  const children = new Map<string, Workspace>(\n    await Promise.all(\n      [...map.entries()].map(\n        async ([packageName, packagePath]) =>\n          [\n            packageName,\n            {\n              ...(await createWorkspace(packagePath)),\n              relativeCwd: path.relative(root.cwd, packagePath),\n            } satisfies Workspace,\n          ] as const,\n      ),\n    ),\n  );\n  return { root, children };\n};\n\nconst isAccessible = (path: string): Promise<boolean> =>\n  fs.access(path).then(\n    () => true,\n    () => false,\n  );\n\nexport const findRootWorkspace = async (\n  cwd: string,\n): Promise<Workspace | null> => {\n  let currentPath = cwd;\n  do {\n    const isRootIfOneOfThesePathsExists = await Promise.all([\n      isAccessible(path.join(currentPath, \".yarnrc.yml\")),\n      isAccessible(path.join(currentPath, \"yarn.lock\")),\n    ]);\n    if (isRootIfOneOfThesePathsExists.some(Boolean)) {\n      return createWorkspace(currentPath);\n    }\n    currentPath = path.dirname(currentPath);\n  } while (currentPath && currentPath !== \"/\");\n  return null;\n};\n\nconst getPackageJsonPath = (cwd: string): string =>\n  path.join(cwd, \"package.json\");\n\nexport const createWorkspace = async (path: string): Promise<Workspace> => {\n  const pkg = await readPkg(path);\n  return { cwd: path, pkg };\n};\n\nexport async function writePkg(\n  workspace: Workspace,\n  prettierOptions = undefined,\n): Promise<void> {\n  const string = await prettyPkg(workspace.pkg, prettierOptions);\n  await fs.writeFile(getPackageJsonPath(workspace.cwd), string, \"utf8\");\n}\n\nexport async function readPkg(cwd: string): Promise<PackageJson> {\n  const packagePath = getPackageJsonPath(cwd);\n  // eslint-disable-next-line @typescript-eslint/use-unknown-in-catch-callback-variable\n  const pkg = await fs.readFile(packagePath, \"utf8\").catch((error: Error) => {\n    throw new Error(\n      `Failed to read package.json in \"${cwd}\": ${error instanceof Error ? error.message : String(error)}`,\n    );\n  });\n  try {\n    return JSON.parse(pkg);\n  } catch (error: unknown) {\n    throw new Error(\n      `Failed to parse package.json in \"${cwd}\": ${error instanceof Error ? error.message : String(error)}`,\n    );\n  }\n}\n","import fs from \"node:fs/promises\";\n\nconst COMMIT_GUIDELINE =\n  \"See [Conventional Commits](https://conventionalcommits.org) for commit guidelines.\";\n\nconst CHANGELOG_HEADER = [\n  \"# Changelog\",\n  \"\",\n  \"All notable changes to this project will be documented in this file.\",\n  COMMIT_GUIDELINE,\n  \"\",\n].join(\"\\n\");\n\nexport const updateChangelogFile = async (\n  versionChangelogContent: string,\n  tagPrefix: string,\n  file = \"CHANGELOG.md\",\n): Promise<void> => {\n  const START_OF_LAST_RELEASE_PATTERN = new RegExp(\n    `(^#+ \\\\[?(?:${tagPrefix})?\\\\d+\\\\.\\\\d+\\\\.\\\\d+|<a name=)`,\n    \"m\",\n  );\n\n  let oldContent = \"\";\n\n  try {\n    oldContent = await fs.readFile(file, \"utf8\");\n    const oldContentStart = oldContent.search(START_OF_LAST_RELEASE_PATTERN);\n    // find the position of the last release and remove header:\n    if (oldContentStart !== -1) {\n      oldContent = oldContent.slice(Math.max(0, oldContentStart));\n    }\n  } catch {}\n\n  await fs.writeFile(\n    file,\n    `${CHANGELOG_HEADER}\\n${versionChangelogContent}\\n${oldContent}`,\n  );\n};\n","/* eslint-disable complexity */\nimport path from \"node:path\";\n// eslint-disable-next-line import/no-unresolved\nimport { ConventionalGitClient } from \"@conventional-changelog/git-client\";\nimport { Option, program } from \"commander\";\nimport { Level, Logger, addConfig } from \"nightingale\";\nimport { ConsoleHandler } from \"nightingale-console\";\nimport { satisfies } from \"semver\";\nimport { UsageError } from \"../utils/UsageError.ts\";\nimport type { BumpType } from \"../utils/bumpTypeUtils.ts\";\nimport {\n  calcBumpRange,\n  calcBumpType,\n  getHighestBumpType,\n  incrementVersion,\n} from \"../utils/bumpTypeUtils.ts\";\nimport {\n  generateChangelog,\n  recommendBump,\n} from \"../utils/conventionalChangelogUtils.ts\";\nimport { loadConventionalCommitConfig } from \"../utils/conventionalCommitConfigUtils.ts\";\nimport { execCommand } from \"../utils/execCommand.ts\";\nimport { asyncIterableToArray } from \"../utils/generatorUtils.ts\";\nimport {\n  createGitCommit,\n  createGitTag,\n  getDirtyFiles,\n  getGitCurrentBranch,\n  isBehindRemote,\n  pushCommitsAndTags,\n} from \"../utils/gitUtils.ts\";\nimport {\n  createGitHubClient,\n  createGitRelease,\n  parseGithubRepoUrl,\n} from \"../utils/githubUtils.ts\";\nimport {\n  PackageDependencyDescriptorUtils,\n  PackageDescriptorNameUtils,\n} from \"../utils/packageDependenciesUtils.ts\";\nimport type { PackageDependencyDescriptor } from \"../utils/packageDependenciesUtils.ts\";\nimport type { Workspace } from \"../utils/packageUtils.ts\";\nimport {\n  createProjectWorkspace,\n  createWorkspace,\n  findRootWorkspace,\n  writePkg,\n} from \"../utils/packageUtils.ts\";\nimport { updateChangelogFile } from \"../utils/updateChangelog.ts\";\nimport type { DependencyType } from \"../utils/workspaceUtils.ts\";\nimport {\n  buildDependenciesMaps,\n  buildTopologicalOrderBatches,\n  getWorkspaceName,\n} from \"../utils/workspaceUtils.ts\";\n\nexport interface VersionCommandOptions {\n  cwd: string;\n  includesRoot: boolean;\n  dryRun: boolean;\n  force?: \"major\" | \"minor\" | \"patch\";\n  prerelease?: string;\n  json: boolean;\n  preset: string;\n  tagVersionPrefix: string;\n  changelog: string;\n  commitMessage: string;\n  createRelease: boolean;\n  bumpDependentsHighestAs: \"major\" | \"minor\" | \"patch\";\n  alwaysBumpPeerDependencies: boolean;\n  gitRemote: string;\n  ignoreChanges?: string;\n  verbose?: boolean;\n  cwdIsRoot?: boolean;\n}\n\ninterface BumpableWorkspace {\n  workspace: Workspace;\n  previousTag?: string;\n  workspaceName: string;\n  isRoot: boolean;\n  version: string;\n}\n\ninterface ChangedWorkspace {\n  bumpReason?: string;\n  bumpType: BumpType;\n}\n\ninterface NoVersionToUpdateWorkspace {\n  // for legacy configuration not using workspaces ranges https://yarnpkg.com/features/workspaces#workspace-ranges-workspace\n  dependenciesToBump: [DependencyType, PackageDependencyDescriptor, string][];\n}\n\ninterface BumpedWorkspace extends ChangedWorkspace, NoVersionToUpdateWorkspace {\n  bumpForDependenciesReasons?: string[];\n  hasChanged: boolean;\n  currentVersion: string;\n  newVersion: string;\n  newTag: string | null;\n}\n\nexport const versionCommandAction = async (\n  options: VersionCommandOptions,\n  { nightingaleHandler = new ConsoleHandler(Level.INFO) } = {},\n): Promise<void> => {\n  // todo nightingale-cli\n  if (options.json) {\n    process.env.NIGHTINGALE_CONSOLE_FORMATTER = \"json\";\n  }\n\n  addConfig({\n    pattern: /^yarn-version/,\n    handler: nightingaleHandler,\n  });\n\n  const logger = new Logger(\"yarn-version\");\n\n  const rootWorkspace = await (options.cwdIsRoot\n    ? createWorkspace(options.cwd)\n    : findRootWorkspace(options.cwd));\n\n  if (!rootWorkspace) {\n    throw new UsageError(\"Could not find root workspace from this path.\");\n  }\n\n  const project = await createProjectWorkspace(rootWorkspace);\n\n  if (!options.dryRun) {\n    const dirtyFiles = await getDirtyFiles(project.root);\n    if (dirtyFiles) {\n      throw new Error(\n        `Dirty Files:\\n${dirtyFiles}\\n\\nThere are uncommitted changes in the git repository. Please commit or stash them first.`,\n      );\n    }\n  }\n\n  const rootWorkspaceChildren = [...project.children.values()];\n  let rootNewVersion = \"\";\n  let rootNewTag = \"\";\n  const isMonorepo = rootWorkspaceChildren.length > 0;\n  const isMonorepoVersionIndependent = isMonorepo && !rootWorkspace.pkg.version;\n  const workspaces =\n    !(isMonorepo && !rootWorkspaceChildren) || options.includesRoot\n      ? [rootWorkspace, ...rootWorkspaceChildren]\n      : rootWorkspaceChildren;\n\n  if (options.prerelease) {\n    throw new UsageError(\"--prerelease is not supported yet.\");\n  }\n  if (options.ignoreChanges) {\n    throw new UsageError(\"--ignore-changes is not supported yet.\");\n  }\n\n  const conventionalGitClient = new ConventionalGitClient(rootWorkspace.cwd);\n\n  const [\n    conventionalCommitConfig,\n    githubClient,\n    parsedRepoUrl,\n    gitCurrentBranch,\n  ] = await Promise.all([\n    loadConventionalCommitConfig(rootWorkspace, options.preset),\n    // create client early to fail fast if necessary\n    options.createRelease ? createGitHubClient() : undefined,\n    options.createRelease ? parseGithubRepoUrl(rootWorkspace) : undefined,\n    getGitCurrentBranch(rootWorkspace),\n  ]);\n\n  const rootPreviousVersionTagPromise = options.force\n    ? null\n    : conventionalGitClient.getLastSemverTag({\n        prefix: options.tagVersionPrefix,\n        skipUnstable: true,\n      });\n\n  const buildTagName = (workspace: Workspace, version: string): string =>\n    `${\n      isMonorepo && workspace !== rootWorkspace\n        ? `${getWorkspaceName(workspace)}@`\n        : options.tagVersionPrefix\n    }${version}`;\n\n  const changedWorkspaces = new Map<Workspace, ChangedWorkspace>();\n  const dependenciesMap = isMonorepo ? buildDependenciesMaps(project) : null;\n\n  // todo logger.group\n  logger.info(\n    options.force\n      ? \"Check all workspaces (force option)\"\n      : \"Finding changed workspaces\",\n  );\n\n  // check workspaces and create bumpableWorkspaces\n\n  const bumpableWorkspaces: BumpableWorkspace[] = [];\n  for (const workspace of workspaces) {\n    const workspaceName = getWorkspaceName(workspace);\n    const isRoot = workspace === rootWorkspace;\n    if (isRoot && isMonorepo && isMonorepoVersionIndependent) continue;\n\n    const version = workspace.pkg.version;\n\n    if (!version || version === \"0.0.0\") {\n      if (\n        (isRoot || isMonorepoVersionIndependent) &&\n        (!isMonorepo || !isMonorepoVersionIndependent)\n      ) {\n        throw new UsageError(\n          'package.json has no version in its manifest. For the first release, set to \"1.0.0-pre\" or \"0.1.0-pre\".',\n        );\n      }\n\n      logger.info(`${workspaceName}: skipped (no version)`);\n      continue;\n    }\n\n    bumpableWorkspaces.push({\n      workspace,\n      workspaceName,\n      isRoot,\n      version,\n    });\n  }\n\n  if (bumpableWorkspaces.length > 0) {\n    logger.info(\"Found bumpable workspaces\", {\n      count: bumpableWorkspaces.length,\n    });\n  }\n\n  const previousTagByWorkspace = new Map<Workspace, string | null>(\n    await Promise.all(\n      bumpableWorkspaces.map(async ({ workspace, workspaceName, isRoot }) => {\n        const packageOption =\n          isMonorepo && isMonorepoVersionIndependent\n            ? workspaceName\n            : undefined;\n\n        const previousVersionTagPrefix = packageOption\n          ? `${packageOption}@`\n          : options.tagVersionPrefix;\n\n        const previousTagAndVersion = await (isRoot ||\n        !isMonorepoVersionIndependent\n          ? rootPreviousVersionTagPromise\n          : conventionalGitClient.getLastSemverTag({\n              prefix: previousVersionTagPrefix,\n              skipUnstable: true,\n            }));\n\n        return [workspace, previousTagAndVersion || null] as const;\n      }),\n    ),\n  );\n\n  if (options.dryRun) {\n    logger.info(\"Previous tags\", {\n      previousTagByWorkspace: Object.fromEntries(\n        [...previousTagByWorkspace.entries()].map(\n          ([workspace, previousTag]) => [\n            getWorkspaceName(workspace),\n            previousTag,\n          ],\n        ),\n      ),\n    });\n  }\n\n  const commitsByWorkspace = options.force\n    ? undefined\n    : new Map(\n        await Promise.all(\n          bumpableWorkspaces.map(async ({ workspace }) => {\n            const previousTag = previousTagByWorkspace.get(workspace);\n\n            const workspaceRelativePath = path.relative(\n              rootWorkspace.cwd,\n              workspace.cwd,\n            );\n            return [\n              workspace,\n              await asyncIterableToArray(\n                conventionalGitClient.getCommits(\n                  {\n                    path: workspaceRelativePath,\n                    from: previousTag || undefined,\n                  },\n                  conventionalCommitConfig.parser,\n                ),\n              ),\n            ] as const;\n          }),\n        ),\n      );\n\n  // find changed workspaces\n\n  for (const { workspace, workspaceName } of bumpableWorkspaces) {\n    let bumpType: BumpType | null = null;\n    let bumpReason: string | undefined;\n\n    if (options.force) {\n      bumpType = options.force;\n      bumpReason = \"forced by --force flag\";\n    } else {\n      const commits = commitsByWorkspace?.get(workspace);\n\n      // No changes found for this package\n      if (!commits || commits.length === 0) {\n        logger.info(`${workspaceName}: skipped (no changes)`);\n        continue;\n      }\n\n      const { releaseType, reason } = await recommendBump(\n        commits,\n        conventionalCommitConfig,\n      );\n      bumpReason = reason;\n\n      if (releaseType) {\n        bumpType = releaseType as BumpType;\n      }\n    }\n\n    if (bumpType) {\n      if (isMonorepo && !workspace.pkg.name) {\n        throw new Error(\"Workspace name is required\");\n      }\n\n      const currentVersion = workspace.pkg.version;\n\n      if (!currentVersion) {\n        throw new UsageError(\n          `Invalid \"${getWorkspaceName(workspace)}\" version`,\n        );\n      }\n\n      changedWorkspaces.set(workspace, {\n        bumpType,\n        bumpReason,\n      });\n    }\n  }\n\n  if (changedWorkspaces.size === 0) {\n    logger.info(\"No changed workspaces\");\n    return;\n  }\n\n  logger.info(\"Preparing bumping\");\n\n  const bumpedWorkspaces = new Map<Workspace, BumpedWorkspace>();\n  const noVersionToUpdateWorkspaces = new Map<\n    Workspace,\n    NoVersionToUpdateWorkspace\n  >();\n  const batches = dependenciesMap\n    ? buildTopologicalOrderBatches(project, dependenciesMap)\n    : [[rootWorkspace]];\n\n  for (const batch of batches) {\n    for (const workspace of batch) {\n      const currentVersion = workspace.pkg.version;\n\n      if (!currentVersion && !workspace.pkg.private) {\n        throw new UsageError(\n          `Invalid \"${getWorkspaceName(workspace)}\" version`,\n        );\n      }\n\n      const changedWorkspace = changedWorkspaces.get(workspace);\n      let bumpType: BumpType | null = null;\n      const bumpReasons: string[] = [];\n      const dependenciesToBump: BumpedWorkspace[\"dependenciesToBump\"] = [];\n\n      if (changedWorkspace) {\n        bumpType = changedWorkspace.bumpType;\n        bumpReasons.push(changedWorkspace.bumpReason || \"by commits\");\n      }\n\n      const dependencies = dependenciesMap?.get(workspace);\n\n      if (dependencies) {\n        for (const [\n          dependencyWorkspace,\n          dependencyType,\n          dependencyDescriptor,\n        ] of dependencies) {\n          const dependencyBumpedWorkspace =\n            bumpedWorkspaces.get(dependencyWorkspace);\n\n          if (!dependencyBumpedWorkspace) {\n            continue;\n          }\n\n          if (\n            dependencyType === \"peerDependencies\" &&\n            !options.alwaysBumpPeerDependencies &&\n            // skip when peerdependency with a new version satisfied by the existing range.\n            satisfies(\n              dependencyBumpedWorkspace.newVersion,\n              dependencyDescriptor.selector,\n              { includePrerelease: true },\n            )\n          ) {\n            continue;\n          }\n\n          const newRange = calcBumpRange(\n            workspace,\n            dependencyDescriptor.selector,\n            dependencyBumpedWorkspace.newVersion,\n          );\n\n          if (dependencyDescriptor.selector === newRange) {\n            continue;\n          }\n\n          dependenciesToBump.push([\n            dependencyType,\n            dependencyDescriptor,\n            newRange,\n          ]);\n\n          bumpType = getHighestBumpType([\n            bumpType ?? \"patch\",\n            calcBumpType(\n              dependencyBumpedWorkspace.bumpType,\n              options.bumpDependentsHighestAs,\n            ),\n          ]);\n\n          bumpReasons.push(\n            `Version bump for dependency: ${PackageDescriptorNameUtils.stringify(dependencyDescriptor.name)}`,\n          );\n        }\n      }\n\n      const workspaceName = getWorkspaceName(workspace);\n      if (!currentVersion) {\n        logger.info(`${workspaceName}: skipped (no version)`);\n        if (workspace !== rootWorkspace) {\n          noVersionToUpdateWorkspaces.set(workspace, {\n            dependenciesToBump,\n          });\n        }\n      } else if (!bumpType) {\n        logger.info(\n          `${workspaceName}: skipped (${\n            changedWorkspace\n              ? `no bump recommended by ${options.preset}`\n              : \"no changes\"\n          })`,\n        );\n      } else {\n        const newVersion = incrementVersion(\n          workspace,\n          currentVersion,\n          bumpType,\n        );\n\n        const tagName = buildTagName(workspace, newVersion);\n\n        if (workspace === rootWorkspace) {\n          rootNewVersion = newVersion;\n          rootNewTag = tagName;\n        }\n\n        if (workspace !== rootWorkspace || !isMonorepo) {\n          const bumpReason = bumpReasons.join(\"\\n\");\n          bumpedWorkspaces.set(workspace, {\n            currentVersion,\n            bumpType,\n            bumpReason,\n            bumpForDependenciesReasons: changedWorkspace\n              ? bumpReasons.slice(1)\n              : bumpReasons,\n            newVersion,\n            newTag: tagName,\n            hasChanged: changedWorkspace !== undefined,\n            dependenciesToBump,\n          });\n\n          logger.info(\n            `${workspaceName}: ${currentVersion} -> ${\n              !isMonorepo || isMonorepoVersionIndependent ? newVersion : \"bump\"\n            } (${bumpReason.replace(\"\\n\", \" ; \")})`,\n          );\n          // TODO Json only:\n          // logger.info({\n          //   cwd: npath.fromPortablePath(workspace.cwd),\n          //   ident: workspaceName,\n          //   oldVersion: currentVersion,\n          //   ...(isMonorepoVersionIndependent ? { newVersion } : {}),\n          //   bumpType,\n          //   bumpReasons,\n          // });\n        }\n      }\n    }\n  }\n\n  // TODO ask for confirmation\n  // if (!this.yes) {\n  // }\n\n  // TODO do this entire phase here, not override for not independent only\n  if (isMonorepo && !isMonorepoVersionIndependent) {\n    const currentVersion = rootWorkspace.pkg.version!;\n    const highestBumpType = getHighestBumpType(\n      [...bumpedWorkspaces.values()].map(({ bumpType }) => bumpType),\n    );\n    const newVersion = incrementVersion(\n      rootWorkspace,\n      currentVersion,\n      highestBumpType,\n    );\n    rootNewVersion = newVersion;\n    rootNewTag = buildTagName(rootWorkspace, newVersion);\n\n    [...bumpedWorkspaces.entries()].forEach(([workspace, bumpedWorkspace]) => {\n      const isRoot = workspace === rootWorkspace;\n      if (isRoot) {\n        throw new Error(\"Unexpected root found in bumped workspaces\");\n      }\n      bumpedWorkspace.bumpType = highestBumpType;\n      bumpedWorkspace.newVersion = newVersion;\n      bumpedWorkspace.newTag = null;\n    });\n\n    [\n      ...bumpedWorkspaces.entries(),\n      ...noVersionToUpdateWorkspaces.entries(),\n    ].forEach(([workspace, { dependenciesToBump }]) => {\n      dependenciesToBump.forEach((dependencyToBump) => {\n        dependencyToBump[2] = calcBumpRange(\n          workspace,\n          dependencyToBump[1].selector,\n          newVersion,\n        );\n      });\n    });\n\n    bumpedWorkspaces.set(rootWorkspace, {\n      currentVersion,\n      bumpType: highestBumpType,\n      hasChanged: true,\n      newVersion: rootNewVersion,\n      newTag: rootNewTag,\n      dependenciesToBump: [],\n    });\n\n    logger.info(\n      `${currentVersion} -> ${newVersion}`,\n      // TODO Json only:\n      // {\n      //   oldVersion: currentVersion,\n      //   newVersion, },\n    );\n  }\n\n  // do modifications\n\n  // Update yarn.lock ; must be done to make sure preversion script can be ran\n\n  if (!options.dryRun) {\n    logger.info(`${getWorkspaceName(rootWorkspace)}: Running install`);\n    await execCommand(rootWorkspace, [\"yarn\", \"install\"], \"inherit\");\n\n    logger.info(\"Lifecycle script: preversion\");\n\n    if (isMonorepoVersionIndependent && rootWorkspace.pkg.scripts?.preversion) {\n      await execCommand(\n        rootWorkspace,\n        [\"yarn\", \"run\", \"preversion\"],\n        \"inherit\",\n      );\n    }\n\n    // lifecycle: preversion\n    for (const workspace of bumpedWorkspaces.keys()) {\n      if (workspace.pkg.scripts?.preversion) {\n        await execCommand(workspace, [\"yarn\", \"run\", \"preversion\"], \"inherit\");\n      }\n    }\n\n    logger.info(\"Modifying versions in package.json\");\n    // update versions\n\n    await Promise.all(\n      [...bumpedWorkspaces.entries()].map(\n        ([workspace, { newVersion, dependenciesToBump }]) => {\n          workspace.pkg.version = newVersion;\n\n          for (const [\n            dependencyType,\n            dependencyDescriptor,\n            dependencyNewRange,\n          ] of dependenciesToBump) {\n            const newDescriptor = PackageDependencyDescriptorUtils.make(\n              dependencyDescriptor,\n              dependencyNewRange,\n            );\n            const [key, newValue] =\n              PackageDependencyDescriptorUtils.stringify(newDescriptor);\n            workspace.pkg[dependencyType]![key] = newValue;\n          }\n\n          return writePkg(workspace);\n        },\n      ),\n    );\n\n    // Update yarn.lock ; must be done before running again lifecycle scripts\n    logger.info(`${getWorkspaceName(rootWorkspace)}: Running install`);\n    await execCommand(rootWorkspace, [\"yarn\", \"install\"], \"inherit\");\n\n    // lifecycle: version\n    logger.info(\"Lifecycle script: version\");\n    for (const workspace of bumpedWorkspaces.keys()) {\n      if (workspace.pkg.scripts?.version) {\n        await execCommand(workspace, [\"yarn\", \"run\", \"version\"], \"inherit\");\n      }\n    }\n  }\n\n  if (isMonorepoVersionIndependent && rootWorkspace.pkg.scripts?.version) {\n    await execCommand(rootWorkspace, [\"yarn\", \"run\", \"version\"], \"inherit\");\n  }\n\n  const changelogs = new Map<Workspace, string>();\n\n  await Promise.all(\n    [...bumpedWorkspaces.entries()].map(\n      async ([\n        workspace,\n        { newTag, hasChanged, bumpReason, bumpForDependenciesReasons },\n      ]) => {\n        const workspaceRelativePath =\n          rootWorkspace === workspace\n            ? undefined\n            : path.relative(rootWorkspace.cwd, workspace.cwd);\n\n        let changelog = await generateChangelog(\n          rootWorkspace,\n          workspace.pkg,\n          conventionalCommitConfig,\n          isMonorepoVersionIndependent ? newTag : rootNewTag,\n          {\n            path: workspaceRelativePath,\n            previousTag: previousTagByWorkspace.get(workspace) || undefined,\n            verbose: options.verbose,\n            tagPrefix: options.tagVersionPrefix,\n            lernaPackage:\n              rootWorkspace === workspace\n                ? undefined\n                : getWorkspaceName(workspace),\n          },\n        );\n\n        if (bumpForDependenciesReasons && workspace !== rootWorkspace) {\n          if (bumpForDependenciesReasons.length > 0) {\n            changelog += `${!changelog.endsWith(\"\\n\\n\") ? \"\\n\" : \"\"}${bumpForDependenciesReasons.join(\"\\n\")}\\n\\n`;\n          }\n        }\n\n        if (changelog.slice(changelog.indexOf(\"\\n\")).trim().length === 0) {\n          changelog += `${!changelog.endsWith(\"\\n\\n\") ? \"\\n\" : \"\"}Note: no notable changes\\n\\n`;\n        }\n\n        if (!changelog && rootWorkspace === workspace) {\n          throw new Error(\"No changelog found for root workspace\");\n        }\n\n        changelogs.set(workspace, changelog);\n\n        if (options.changelog) {\n          if (options.dryRun) {\n            logger.info(\n              `${getWorkspaceName(workspace)}: ${\n                options.changelog\n              }\\n${changelog}`,\n            );\n          } else {\n            await updateChangelogFile(\n              changelog,\n              options.tagVersionPrefix,\n              `${workspace.cwd}/${options.changelog}`,\n            );\n          }\n        }\n      },\n    ),\n  );\n\n  if (!options.dryRun) {\n    // TODO nightingale separator\n    console.log();\n\n    // install to update versions in lock file\n    logger.info(`${getWorkspaceName(rootWorkspace)}: Running install`);\n    await execCommand(rootWorkspace, [\"yarn\", \"install\"], \"inherit\");\n\n    // TODO nightingale separator\n    console.log();\n\n    logger.info(\"Commit, tag and push\", {\n      changedFiles: await getDirtyFiles(rootWorkspace),\n    });\n\n    const tagsSet = new Set<string>(\n      [...bumpedWorkspaces.values()]\n        .map(({ newTag }) => newTag)\n        .filter((newTag) => newTag !== null),\n    );\n\n    const tagsInCommitMessage = [...tagsSet]\n      .map((tag) => `- ${tag}`)\n      .join(\"\\n\");\n    const message = options.commitMessage\n      .replace(/\\\\n/g, \"\\n\")\n      .replace(\n        /%a/g,\n        isMonorepoVersionIndependent\n          ? `\\n\\n${tagsInCommitMessage}`\n          : rootNewVersion,\n      )\n      .replace(/%s/g, rootNewTag)\n      .replace(/%v/g, rootNewVersion)\n      .replace(/%t/g, tagsInCommitMessage);\n\n    await createGitCommit(rootWorkspace, message);\n\n    for (const [workspace, { newTag }] of bumpedWorkspaces.entries()) {\n      if (newTag === null) continue;\n      await createGitTag(workspace, newTag);\n    }\n\n    if (\n      await isBehindRemote(rootWorkspace, options.gitRemote, gitCurrentBranch)\n    ) {\n      logger.error(\"Remote is ahead, aborting\");\n      // eslint-disable-next-line unicorn/no-process-exit\n      process.exit(1);\n    }\n\n    await pushCommitsAndTags(\n      rootWorkspace,\n      options.gitRemote,\n      gitCurrentBranch,\n    );\n\n    // run postversion\n    if (rootWorkspace.pkg.scripts?.postversion) {\n      await execCommand(\n        rootWorkspace,\n        [\"yarn\", \"run\", \"postversion\"],\n        \"inherit\",\n      );\n    }\n\n    // TODO open github PR\n\n    if (options.createRelease && githubClient && parsedRepoUrl) {\n      logger.info(\"Create git release\");\n\n      await Promise.all(\n        [...bumpedWorkspaces.entries()].map(([workspace, { newTag }]) => {\n          if (newTag === null) return undefined;\n          const changelog = changelogs.get(workspace);\n          if (!changelog) {\n            logger.warn(\n              `No changelog found for workspace: ${getWorkspaceName(\n                workspace,\n              )}`,\n            );\n            return undefined;\n          }\n          return createGitRelease(\n            githubClient,\n            parsedRepoUrl,\n            newTag,\n            changelog,\n            !!options.prerelease,\n          );\n        }),\n      );\n    }\n  }\n\n  if (process.env.NODE_ENV !== \"test\") {\n    // issue in @conventional-changelog/git-client\n    // eslint-disable-next-line unicorn/no-process-exit\n    process.exit(0);\n  }\n};\n\nexport const Defaults: VersionCommandOptions = {\n  cwd: process.cwd(),\n  includesRoot: false,\n  dryRun: false,\n  json: false,\n  preset: \"conventional-changelog-conventionalcommits\",\n  tagVersionPrefix: \"v\",\n  changelog: \"CHANGELOG.md\",\n  commitMessage: \"chore: release %a\",\n  createRelease: false,\n  bumpDependentsHighestAs: \"major\",\n  alwaysBumpPeerDependencies: false,\n  gitRemote: \"origin\",\n  verbose: false,\n};\n\nexport default program\n  .command(\"version\")\n  .usage(\"Bump package version using conventional commit\")\n  .addOption(\n    new Option(\"--includes-root\", \"Release root workspace [untested]\").default(\n      Defaults.includesRoot,\n    ),\n  )\n  .addOption(new Option(\"--cwd\", \"working directory\").default(process.cwd()))\n  .addOption(\n    new Option(\n      \"--dry-run\",\n      \"Print the versions without actually generating the package archive\",\n    ).default(Defaults.dryRun),\n  )\n  .addOption(new Option(\"-v,--verbose\").default(Defaults.verbose))\n  .addOption(\n    new Option(\"--force <type>\", \"Specify the release type\").choices([\n      \"major\",\n      \"minor\",\n      \"patch\",\n    ]),\n  )\n  .addOption(\n    new Option(\n      \"--prerelease [releaseType]\",\n      \"Add a prerelease identifier to new versions\",\n    ),\n  )\n  .addOption(\n    new Option(\n      \"--preset <presetName>\",\n      \"Conventional Changelog preset to require. Defaults to conventional-changelog-conventionalcommits.\",\n    ).default(\"conventional-changelog-conventionalcommits\"),\n  )\n  .addOption(\n    new Option(\"--tag-version-prefix <prefix>\", \"Tag version prefix\").default(\n      Defaults.tagVersionPrefix,\n    ),\n  )\n  .addOption(\n    new Option(\n      \"--changelog <path>\",\n      \"Changelog path. Default to CHANGELOG.md.\",\n    ).default(Defaults.changelog),\n  )\n  .addOption(\n    new Option(\n      \"-m,--commit-message <message>\",\n      'Commit message. Default to \"chore: release %a\". You can use %v for the version, %s for the version with prefix, %t to list tags, %a for auto best display.',\n    ).default(Defaults.commitMessage),\n  )\n  .addOption(\n    new Option(\"--create-release <type>\", \"Create a release\").choices([\n      \"github\",\n    ]),\n  )\n  .addOption(\n    new Option(\n      \"--bump-dependents-highest-as <type>\",\n      \"Bump dependents highest version as major, minor or patch\",\n    )\n      .choices([\"major\", \"minor\", \"patch\"])\n      .default(Defaults.bumpDependentsHighestAs),\n  )\n  .addOption(\n    new Option(\n      \"--always-bump-peer-dependencies\",\n      \"Always bump peer dependencies. Default to bumping only if the version doesn't satisfies the peer dependency range.\",\n    ).default(Defaults.alwaysBumpPeerDependencies),\n  )\n  .addOption(\n    new Option(\n      \"--git-remote <remote-name>\",\n      \"Git remote to push commits and tags to\",\n    ).default(Defaults.gitRemote),\n  )\n  .addOption(\n    new Option(\n      \"--ignore-changes <glob>\",\n      'Ignore changes in files matching the glob. Example: \"**/*.test.js\"',\n    ),\n  )\n  .action((options) => versionCommandAction(options));\n","import fs from \"node:fs\";\nimport { program } from \"commander\";\n\nimport \"./commands/version.ts\";\n\n// relative to dist directory\nconst pkg = JSON.parse(\n  // eslint-disable-next-line unicorn/prefer-json-parse-buffer\n  fs.readFileSync(new URL(\"../package.json\", import.meta.url), \"utf8\"),\n);\n\nprogram.name(pkg.name).description(pkg.description).version(pkg.version);\nprogram.parse();\n"],"names":["selector","path","fs"],"mappings":"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"}